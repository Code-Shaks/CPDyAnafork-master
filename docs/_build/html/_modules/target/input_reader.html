

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>target.input_reader &mdash; CPDyAna 01-02-2024 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=18cd0f04"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            CPDyAna
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">API Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../target.html">Target Package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#main-analysis-driver">Main Analysis Driver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#cpdyana-combined-molecular-dynamics-analysis-tool">CPDyAna â€“ Combined Molecular Dynamics Analysis Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.CPDyAna.Job"><code class="docutils literal notranslate"><span class="pre">Job()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.CPDyAna.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.CPDyAna.parser"><code class="docutils literal notranslate"><span class="pre">parser()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#key-functions">Key Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#data-processing">Data Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#general-data-processing-module-for-cpdyana">General Data Processing Module for CPDyAna</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.data_processing.data_evaluator"><code class="docutils literal notranslate"><span class="pre">data_evaluator()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.data_processing.find_terms"><code class="docutils literal notranslate"><span class="pre">find_terms()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.data_processing.segmenter_func"><code class="docutils literal notranslate"><span class="pre">segmenter_func()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#lammps-data-processing">LAMMPS Data Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#lammps-data-processing-module-for-cpdyana">LAMMPS Data Processing Module for CPDyAna</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.data_processing_lammps.calculate_time_window_lammps"><code class="docutils literal notranslate"><span class="pre">calculate_time_window_lammps()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.data_processing_lammps.data_evaluator_lammps"><code class="docutils literal notranslate"><span class="pre">data_evaluator_lammps()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.data_processing_lammps.detect_lammps_format"><code class="docutils literal notranslate"><span class="pre">detect_lammps_format()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.data_processing_lammps.find_terms_lammps"><code class="docutils literal notranslate"><span class="pre">find_terms_lammps()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.data_processing_lammps.is_lammps_simulation"><code class="docutils literal notranslate"><span class="pre">is_lammps_simulation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.data_processing_lammps.segmenter_func_lammps"><code class="docutils literal notranslate"><span class="pre">segmenter_func_lammps()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#input-output-operations">Input/Output Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#input-file-reader-module-for-cpdyana">Input File Reader Module for CPDyAna</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.input_reader.detect_trajectory_format"><code class="docutils literal notranslate"><span class="pre">detect_trajectory_format()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.input_reader.export_verification_trajectory"><code class="docutils literal notranslate"><span class="pre">export_verification_trajectory()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.input_reader.generate_analysis_recommendations"><code class="docutils literal notranslate"><span class="pre">generate_analysis_recommendations()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.input_reader.has_type_column"><code class="docutils literal notranslate"><span class="pre">has_type_column()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.input_reader.read_bomd_trajectory"><code class="docutils literal notranslate"><span class="pre">read_bomd_trajectory()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.input_reader.read_cel_file"><code class="docutils literal notranslate"><span class="pre">read_cel_file()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.input_reader.read_evp_file"><code class="docutils literal notranslate"><span class="pre">read_evp_file()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.input_reader.read_ion_file"><code class="docutils literal notranslate"><span class="pre">read_ion_file()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.input_reader.read_ion_file_universal"><code class="docutils literal notranslate"><span class="pre">read_ion_file_universal()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.input_reader.read_lammps_trajectory"><code class="docutils literal notranslate"><span class="pre">read_lammps_trajectory()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.input_reader.read_pos_file"><code class="docutils literal notranslate"><span class="pre">read_pos_file()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.io.get_indices"><code class="docutils literal notranslate"><span class="pre">get_indices()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.io.get_position_indices"><code class="docutils literal notranslate"><span class="pre">get_position_indices()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.io.get_thermo_props"><code class="docutils literal notranslate"><span class="pre">get_thermo_props()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.io.iter_lammps_dump"><code class="docutils literal notranslate"><span class="pre">iter_lammps_dump()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.io.pos_2_absolute"><code class="docutils literal notranslate"><span class="pre">pos_2_absolute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.io.read_lammps_dump"><code class="docutils literal notranslate"><span class="pre">read_lammps_dump()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.io.read_positions_with_ase"><code class="docutils literal notranslate"><span class="pre">read_positions_with_ase()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.io.read_step_info"><code class="docutils literal notranslate"><span class="pre">read_step_info()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.io.read_xsf"><code class="docutils literal notranslate"><span class="pre">read_xsf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.io.write_grid"><code class="docutils literal notranslate"><span class="pre">write_grid()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.io.write_xsf"><code class="docutils literal notranslate"><span class="pre">write_xsf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#supported-file-types">Supported File Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#core-calculations">Core Calculations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#calculations-module-for-cpdyana">Calculations Module for CPDyAna</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.calculations.calc_fft"><code class="docutils literal notranslate"><span class="pre">calc_fft()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.calculations.calc_msd_tracer"><code class="docutils literal notranslate"><span class="pre">calc_msd_tracer()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.calculations.calc_ngp_tracer"><code class="docutils literal notranslate"><span class="pre">calc_ngp_tracer()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.calculations.calculate_msd"><code class="docutils literal notranslate"><span class="pre">calculate_msd()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.calculations.calculate_msd_lammps"><code class="docutils literal notranslate"><span class="pre">calculate_msd_lammps()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.calculations.calculate_msd_qe"><code class="docutils literal notranslate"><span class="pre">calculate_msd_qe()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.calculations.calculate_ngp"><code class="docutils literal notranslate"><span class="pre">calculate_ngp()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.calculations.disp_sum"><code class="docutils literal notranslate"><span class="pre">disp_sum()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.calculations.msd_charged"><code class="docutils literal notranslate"><span class="pre">msd_charged()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.calculations.msd_tracer"><code class="docutils literal notranslate"><span class="pre">msd_tracer()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#analysis-types">Analysis Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#correlation-analysis">Correlation Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#correlation-analysis-module-for-cpdyana">Correlation Analysis Module for CPDyAna</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.correrelation_analysis.Van_Hove_distinct"><code class="docutils literal notranslate"><span class="pre">Van_Hove_distinct()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.correrelation_analysis.Van_Hove_self"><code class="docutils literal notranslate"><span class="pre">Van_Hove_self()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#correlation-types">Correlation Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#rdf-computation">RDF Computation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.compute_rdf.build_ase_trajectory"><code class="docutils literal notranslate"><span class="pre">build_ase_trajectory()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.compute_rdf.build_bomd_trajectory"><code class="docutils literal notranslate"><span class="pre">build_bomd_trajectory()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.compute_rdf.build_lammps_trajectory"><code class="docutils literal notranslate"><span class="pre">build_lammps_trajectory()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.compute_rdf.compute_rdf"><code class="docutils literal notranslate"><span class="pre">compute_rdf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.compute_rdf.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#vaf-computation">VAF Computation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.compute_vaf.build_bomd_trajectory"><code class="docutils literal notranslate"><span class="pre">build_bomd_trajectory()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.compute_vaf.build_trajectory"><code class="docutils literal notranslate"><span class="pre">build_trajectory()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.compute_vaf.compute_vaf"><code class="docutils literal notranslate"><span class="pre">compute_vaf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.compute_vaf.convert_symbols_to_atomic_numbers"><code class="docutils literal notranslate"><span class="pre">convert_symbols_to_atomic_numbers()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.compute_vaf.finite_diff_velocities"><code class="docutils literal notranslate"><span class="pre">finite_diff_velocities()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#vdos-analysis">VDOS Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#plotting-and-visualization">Plotting and Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#plotting-and-visualization-module-for-cpdyana">Plotting and Visualization Module for CPDyAna</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.centers_to_edges"><code class="docutils literal notranslate"><span class="pre">centers_to_edges()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.centers_to_edges_time"><code class="docutils literal notranslate"><span class="pre">centers_to_edges_time()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.int_or_float"><code class="docutils literal notranslate"><span class="pre">int_or_float()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.msd_plot"><code class="docutils literal notranslate"><span class="pre">msd_plot()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.msd_plot_lammps"><code class="docutils literal notranslate"><span class="pre">msd_plot_lammps()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.msd_plot_qe"><code class="docutils literal notranslate"><span class="pre">msd_plot_qe()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.ngp_plot"><code class="docutils literal notranslate"><span class="pre">ngp_plot()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.parse_cli_args"><code class="docutils literal notranslate"><span class="pre">parse_cli_args()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.plot_angular_spec"><code class="docutils literal notranslate"><span class="pre">plot_angular_spec()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.plot_power_spectrum"><code class="docutils literal notranslate"><span class="pre">plot_power_spectrum()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.plot_rdf"><code class="docutils literal notranslate"><span class="pre">plot_rdf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.plot_vaf_isotropic"><code class="docutils literal notranslate"><span class="pre">plot_vaf_isotropic()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.plotting.van_hove_plot"><code class="docutils literal notranslate"><span class="pre">van_hove_plot()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#probability-density-analysis">Probability Density Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#probability-density-calculation-module-for-cpdyana">Probability Density Calculation Module for CPDyAna</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.probability_density.build_bomd_trajectory"><code class="docutils literal notranslate"><span class="pre">build_bomd_trajectory()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.probability_density.build_lammps_trajectory"><code class="docutils literal notranslate"><span class="pre">build_lammps_trajectory()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.probability_density.build_trajectory"><code class="docutils literal notranslate"><span class="pre">build_trajectory()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.probability_density.calculate_probability_density"><code class="docutils literal notranslate"><span class="pre">calculate_probability_density()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.probability_density.convert_symbols_to_atomic_numbers"><code class="docutils literal notranslate"><span class="pre">convert_symbols_to_atomic_numbers()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.probability_density.divide_chunks"><code class="docutils literal notranslate"><span class="pre">divide_chunks()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.probability_density.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.probability_density.parse_mask"><code class="docutils literal notranslate"><span class="pre">parse_mask()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#trajectory-utilities">Trajectory Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.trajectory.IncompatibleTrajectoriesException"><code class="docutils literal notranslate"><span class="pre">IncompatibleTrajectoriesException</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory"><code class="docutils literal notranslate"><span class="pre">Trajectory</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.atoms"><code class="docutils literal notranslate"><span class="pre">Trajectory.atoms</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.types"><code class="docutils literal notranslate"><span class="pre">Trajectory.types</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.nat"><code class="docutils literal notranslate"><span class="pre">Trajectory.nat</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.cell"><code class="docutils literal notranslate"><span class="pre">Trajectory.cell</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.nstep"><code class="docutils literal notranslate"><span class="pre">Trajectory.nstep</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.__init__"><code class="docutils literal notranslate"><span class="pre">Trajectory.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#id0"><code class="docutils literal notranslate"><span class="pre">Trajectory.atoms</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.calculate_velocities_from_positions"><code class="docutils literal notranslate"><span class="pre">Trajectory.calculate_velocities_from_positions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#id1"><code class="docutils literal notranslate"><span class="pre">Trajectory.cell</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.from_atoms"><code class="docutils literal notranslate"><span class="pre">Trajectory.from_atoms()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_ase_trajectory"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_ase_trajectory()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_atom_types"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_atom_types()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_atoms"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_atoms()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_cells"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_cells()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_forces"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_forces()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_indices_of_species"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_indices_of_species()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_positions"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_positions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_step_atoms"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_step_atoms()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_stress"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_stress()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_timestep"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_timestep()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_types"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_types()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_velocities"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_velocities()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.get_volumes"><code class="docutils literal notranslate"><span class="pre">Trajectory.get_volumes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#id2"><code class="docutils literal notranslate"><span class="pre">Trajectory.nat</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.recenter"><code class="docutils literal notranslate"><span class="pre">Trajectory.recenter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.set_atom_types"><code class="docutils literal notranslate"><span class="pre">Trajectory.set_atom_types()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.set_atoms"><code class="docutils literal notranslate"><span class="pre">Trajectory.set_atoms()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.set_cells"><code class="docutils literal notranslate"><span class="pre">Trajectory.set_cells()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.set_forces"><code class="docutils literal notranslate"><span class="pre">Trajectory.set_forces()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.set_positions"><code class="docutils literal notranslate"><span class="pre">Trajectory.set_positions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.set_pot_energies"><code class="docutils literal notranslate"><span class="pre">Trajectory.set_pot_energies()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.set_stress"><code class="docutils literal notranslate"><span class="pre">Trajectory.set_stress()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.set_timestep"><code class="docutils literal notranslate"><span class="pre">Trajectory.set_timestep()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.set_types"><code class="docutils literal notranslate"><span class="pre">Trajectory.set_types()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.trajectory.Trajectory.set_velocities"><code class="docutils literal notranslate"><span class="pre">Trajectory.set_velocities()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#id3"><code class="docutils literal notranslate"><span class="pre">Trajectory.types</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.trajectory.check_trajectory_compatibility"><code class="docutils literal notranslate"><span class="pre">check_trajectory_compatibility()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#general-utilities">General Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#utility-module-for-samos-package">Utility Module for SAMOS Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray"><code class="docutils literal notranslate"><span class="pre">AttributedArray</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray._arrays"><code class="docutils literal notranslate"><span class="pre">AttributedArray._arrays</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray._attrs"><code class="docutils literal notranslate"><span class="pre">AttributedArray._attrs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray._nstep"><code class="docutils literal notranslate"><span class="pre">AttributedArray._nstep</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.__init__"><code class="docutils literal notranslate"><span class="pre">AttributedArray.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.get_array"><code class="docutils literal notranslate"><span class="pre">AttributedArray.get_array()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.get_arraynames"><code class="docutils literal notranslate"><span class="pre">AttributedArray.get_arraynames()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.get_attr"><code class="docutils literal notranslate"><span class="pre">AttributedArray.get_attr()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.get_attrs"><code class="docutils literal notranslate"><span class="pre">AttributedArray.get_attrs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.load_file"><code class="docutils literal notranslate"><span class="pre">AttributedArray.load_file()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.nstep"><code class="docutils literal notranslate"><span class="pre">AttributedArray.nstep</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.remove_array"><code class="docutils literal notranslate"><span class="pre">AttributedArray.remove_array()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.rescale_array"><code class="docutils literal notranslate"><span class="pre">AttributedArray.rescale_array()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.save"><code class="docutils literal notranslate"><span class="pre">AttributedArray.save()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.set_array"><code class="docutils literal notranslate"><span class="pre">AttributedArray.set_array()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.utilities.AttributedArray.set_attr"><code class="docutils literal notranslate"><span class="pre">AttributedArray.set_attr()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.utilities.InputError"><code class="docutils literal notranslate"><span class="pre">InputError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.utilities.apply_minimum_image"><code class="docutils literal notranslate"><span class="pre">apply_minimum_image()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.utilities.get_color"><code class="docutils literal notranslate"><span class="pre">get_color()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.utilities.get_terminal_width"><code class="docutils literal notranslate"><span class="pre">get_terminal_width()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#analysis-helpers">Analysis Helpers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.analysis.BaseAnalyzer"><code class="docutils literal notranslate"><span class="pre">BaseAnalyzer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.analysis.BaseAnalyzer.__init__"><code class="docutils literal notranslate"><span class="pre">BaseAnalyzer.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.analysis.BaseAnalyzer.run"><code class="docutils literal notranslate"><span class="pre">BaseAnalyzer.run()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.analysis.BaseAnalyzer.set_trajectory"><code class="docutils literal notranslate"><span class="pre">BaseAnalyzer.set_trajectory()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.analysis.DynamicsAnalyzer"><code class="docutils literal notranslate"><span class="pre">DynamicsAnalyzer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.analysis.DynamicsAnalyzer.__init__"><code class="docutils literal notranslate"><span class="pre">DynamicsAnalyzer.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.analysis.DynamicsAnalyzer.get_kinetic_energies"><code class="docutils literal notranslate"><span class="pre">DynamicsAnalyzer.get_kinetic_energies()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.analysis.DynamicsAnalyzer.get_power_spectrum"><code class="docutils literal notranslate"><span class="pre">DynamicsAnalyzer.get_power_spectrum()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.analysis.DynamicsAnalyzer.get_species_of_interest"><code class="docutils literal notranslate"><span class="pre">DynamicsAnalyzer.get_species_of_interest()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.analysis.DynamicsAnalyzer.get_vaf"><code class="docutils literal notranslate"><span class="pre">DynamicsAnalyzer.get_vaf()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.analysis.DynamicsAnalyzer.set_species_of_interest"><code class="docutils literal notranslate"><span class="pre">DynamicsAnalyzer.set_species_of_interest()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.analysis.DynamicsAnalyzer.set_trajectories"><code class="docutils literal notranslate"><span class="pre">DynamicsAnalyzer.set_trajectories()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.analysis.DynamicsAnalyzer.set_verbosity"><code class="docutils literal notranslate"><span class="pre">DynamicsAnalyzer.set_verbosity()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.analysis.TimeSeries"><code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.analysis.get_gaussian_density"><code class="docutils literal notranslate"><span class="pre">get_gaussian_density()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#target.analysis.write_xsf_header"><code class="docutils literal notranslate"><span class="pre">write_xsf_header()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#preprocessing">Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html#utility-modules">Utility Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#module-target.json_serializable">JSON Serialization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#json-serialization-utilities-for-cpdyana">JSON Serialization Utilities for CPDyAna</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#target.json_serializable.convert_to_serializable"><code class="docutils literal notranslate"><span class="pre">convert_to_serializable()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../target.html#module-target.const">Constants</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../target.html#physical-constants-and-unit-conversions-for-cpdyana">Physical Constants and Unit Conversions for CPDyAna</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage_Examples.html">Usage Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../usage_Examples.html#command-line-interface-examples">Command-Line Interface Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#mean-square-displacement-msd">Mean Square Displacement (MSD)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#non-gaussian-parameter-ngp">Non-Gaussian Parameter (NGP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#van-hove-correlation-functions">Van Hove Correlation Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#radial-distribution-functions-rdf">Radial Distribution Functions (RDF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#ionic-density-mapping">Ionic Density Mapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#velocity-autocorrelation-functions-vaf">Velocity Autocorrelation Functions (VAF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#vibrational-density-of-states-vdos">Vibrational Density of States (VDOS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage_Examples.html#python-api-examples">Python API Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#direct-function-usage">Direct Function Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#samos-module-integration">SAMOS Module Integration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage_Examples.html#batch-processing-workflows">Batch Processing Workflows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#processing-multiple-simulations">Processing Multiple Simulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#temperature-series-analysis">Temperature Series Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage_Examples.html#advanced-analysis-examples">Advanced Analysis Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#custom-van-hove-analysis">Custom Van Hove Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage_Examples.html#file-format-tips">File Format Tips</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#required-file-structure">Required File Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage_Examples.html#performance-optimization">Performance Optimization</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Module Index:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Usage Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../modules.html#basic-msd-analysis">Basic MSD Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules.html#non-gaussian-parameter-ngp-analysis">Non-Gaussian Parameter (NGP) Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules.html#van-hove-correlation-function">Van Hove Correlation Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules.html#radial-distribution-function-rdf">Radial Distribution Function (RDF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules.html#velocity-autocorrelation-function-vaf">Velocity Autocorrelation Function (VAF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules.html#vibrational-density-of-states-vdos">Vibrational Density of States (VDOS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules.html#ionic-density-mapping">Ionic Density Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules.html#batch-processing-workflows">Batch Processing Workflows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../modules.html#processing-multiple-simulations">Processing Multiple Simulations</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CPDyAna</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">target.input_reader</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for target.input_reader</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Input File Reader Module for CPDyAna</span>
<span class="sd">====================================</span>

<span class="sd">This module provides functions for reading and parsing various input file formats</span>
<span class="sd">used in molecular dynamics simulations, particularly those from Quantum ESPRESSO,</span>
<span class="sd">LAMMPS, and BOMD (.trj).</span>

<span class="sd">Supported file formats:</span>
<span class="sd">- .pos files: Position trajectories with atomic coordinates</span>
<span class="sd">- .cel files: Unit cell parameters and lattice vectors</span>
<span class="sd">- .evp files: Energy, volume, and pressure data</span>
<span class="sd">- .in files: Ion definitions and atomic species information</span>
<span class="sd">- LAMMPS dump files: Trajectories from LAMMPS</span>
<span class="sd">- BOMD .trj files: Born-Oppenheimer MD trajectories</span>

<span class="sd">The module handles unit conversions (typically Bohr to Angstrom) and provides</span>
<span class="sd">structured data arrays suitable for analysis functions.</span>

<span class="sd">Functions:</span>
<span class="sd">    detect_trajectory_format: Auto-detects trajectory format in a directory.</span>
<span class="sd">    generate_analysis_recommendations: Prints recommended analysis parameters.</span>
<span class="sd">    export_verification_trajectory: Writes a short trajectory for verification.</span>
<span class="sd">    has_type_column: Checks if LAMMPS dump file has a &#39;type&#39; column.</span>
<span class="sd">    read_lammps_trajectory: Reads and parses LAMMPS trajectory files.</span>
<span class="sd">    read_bomd_trajectory: Reads and parses BOMD .trj trajectory files.</span>
<span class="sd">    read_ion_file_universal: Reads ion info from file or list.</span>
<span class="sd">    read_ion_file: Reads atomic species from .in file.</span>
<span class="sd">    read_cel_file: Reads cell parameters from .cel file.</span>
<span class="sd">    read_evp_file: Reads thermodynamic data from .evp file.</span>
<span class="sd">    read_pos_file: Reads position trajectory from .pos file.</span>

<span class="sd">Author: CPDyAna Development Team</span>
<span class="sd">Version: 01-02-2024</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">target.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_lammps_dump</span><span class="p">,</span> <span class="n">iter_lammps_dump</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ase</span><span class="w"> </span><span class="kn">import</span> <span class="n">Atoms</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ase.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">read</span><span class="p">,</span> <span class="n">write</span>

<div class="viewcode-block" id="detect_trajectory_format">
<a class="viewcode-back" href="../../target.html#target.input_reader.detect_trajectory_format">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">detect_trajectory_format</span><span class="p">(</span><span class="n">data_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Automatically detect trajectory file formats in the data directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_dir (str): Path to directory containing trajectory files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Format information with file paths and detected format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">format_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;pos_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;cel_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;evp_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;ion_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;lammps_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;xsf_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;vasp_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;cp2k_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;gromacs_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;bomd_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;trajectory_files&#39;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="c1"># Check for LAMMPS trajectory files</span>
    <span class="n">lammps_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*.lammpstrj&#39;</span><span class="p">,</span> <span class="s1">&#39;*.dump&#39;</span><span class="p">,</span> <span class="s1">&#39;*.lmp&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">lammps_patterns</span><span class="p">:</span>
        <span class="n">lammps_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">lammps_files</span><span class="p">:</span>
            <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lammps&#39;</span>
            <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;lammps_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lammps_files</span>
            <span class="k">return</span> <span class="n">format_info</span>

    <span class="c1"># Check for Quantum ESPRESSO files</span>
    <span class="n">qe_files</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;*.pos&quot;</span><span class="p">))),</span>
        <span class="s1">&#39;cel&#39;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;*.cel&quot;</span><span class="p">))),</span>
        <span class="s1">&#39;evp&#39;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;*.evp&quot;</span><span class="p">))),</span>
        <span class="s1">&#39;ion&#39;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;*.in&quot;</span><span class="p">)))</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">qe_files</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;quantum_espresso&#39;</span>
        <span class="n">format_info</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_files&#39;</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">qe_files</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="k">return</span> <span class="n">format_info</span>
    
    <span class="c1"># BOMD .trj or .trajectory files</span>
    <span class="n">bomd_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*.trj&#39;</span><span class="p">,</span> <span class="s1">&#39;*.trajectory&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">bomd_patterns</span><span class="p">:</span>
        <span class="n">bomd_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">bomd_files</span><span class="p">:</span>
            <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bomd&#39;</span>
            <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;bomd_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bomd_files</span>
            <span class="k">return</span> <span class="n">format_info</span>

    <span class="c1"># XSF detection</span>
    <span class="n">xsf_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;*.xsf&quot;</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">xsf_files</span><span class="p">:</span>
        <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;xsf&#39;</span>
        <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;xsf_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xsf_files</span>
        <span class="k">return</span> <span class="n">format_info</span>

    <span class="c1"># VASP detection (OUTCAR, XDATCAR, etc.)</span>
    <span class="n">vasp_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;OUTCAR&quot;</span><span class="p">)))</span> <span class="o">+</span> \
                 <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;XDATCAR&quot;</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">vasp_files</span><span class="p">:</span>
        <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;vasp&#39;</span>
        <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;vasp_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vasp_files</span>
        <span class="k">return</span> <span class="n">format_info</span>

    <span class="c1"># CP2K detection (.pdb, .xyz with CP2K header)</span>
    <span class="n">cp2k_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;*.pdb&quot;</span><span class="p">)))</span> <span class="o">+</span> \
                 <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;*.xyz&quot;</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">cp2k_files</span><span class="p">:</span>
        <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;cp2k&#39;</span>
        <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;cp2k_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cp2k_files</span>
        <span class="k">return</span> <span class="n">format_info</span>

    <span class="c1"># GROMACS detection (.gro, .xtc)</span>
    <span class="n">gromacs_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;*.gro&quot;</span><span class="p">)))</span> <span class="o">+</span> \
                    <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;*.xtc&quot;</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">gromacs_files</span><span class="p">:</span>
        <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gromacs&#39;</span>
        <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;gromacs_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gromacs_files</span>
        <span class="k">return</span> <span class="n">format_info</span>

    <span class="c1"># Generic ASE-compatible detection (fallback)</span>
    <span class="n">ase_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;*.extxyz&#39;</span><span class="p">,</span> <span class="s1">&#39;*.traj&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">ase_patterns</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ase_compatible&#39;</span>
            <span class="n">format_info</span><span class="p">[</span><span class="s1">&#39;trajectory_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">files</span>
            <span class="k">return</span> <span class="n">format_info</span>

    <span class="k">return</span> <span class="n">format_info</span></div>


<div class="viewcode-block" id="generate_analysis_recommendations">
<a class="viewcode-back" href="../../target.html#target.input_reader.generate_analysis_recommendations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_analysis_recommendations</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">time_difference</span><span class="p">,</span> <span class="n">n_frames</span><span class="p">,</span> <span class="n">inp_array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate smart analysis parameter recommendations based on trajectory characteristics.</span>

<span class="sd">    Args:</span>
<span class="sd">        times (np.ndarray): Array of time values.</span>
<span class="sd">        time_difference (float): Time step between frames.</span>
<span class="sd">        n_frames (int): Number of frames.</span>
<span class="sd">        inp_array (list): List of element symbols.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None. Prints recommendations to stdout.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_time</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">equilibration_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">total_time</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># 10% or min 10 ps</span>
    <span class="n">analysis_start</span> <span class="o">=</span> <span class="n">equilibration_time</span>
    <span class="n">analysis_end</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">slope_start</span> <span class="o">=</span> <span class="n">equilibration_time</span> <span class="o">+</span> <span class="mf">5.0</span>
    <span class="n">slope_end</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">5.0</span>
    
    <span class="c1"># Frame indices for analysis</span>
    <span class="n">start_frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">analysis_start</span> <span class="o">/</span> <span class="n">time_difference</span><span class="p">)</span>
    <span class="n">end_frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">analysis_end</span> <span class="o">/</span> <span class="n">time_difference</span><span class="p">)</span>
    <span class="n">analysis_frames</span> <span class="o">=</span> <span class="n">end_frame</span> <span class="o">-</span> <span class="n">start_frame</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== ANALYSIS PARAMETER RECOMMENDATIONS ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FOR MSD/VH/NGP ANALYSIS:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --initial-time </span><span class="si">{</span><span class="n">analysis_start</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --final-time </span><span class="si">{</span><span class="n">analysis_end</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --initial-slope-time </span><span class="si">{</span><span class="n">slope_start</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --final-slope-time </span><span class="si">{</span><span class="n">slope_end</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --lammps-timestep </span><span class="si">{</span><span class="n">time_difference</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get unique elements</span>
    <span class="n">unique_elements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inp_array</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --diffusing-elements </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unique_elements</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># First 3 elements</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --lammps-elements </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unique_elements</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">FOR RDF ANALYSIS:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --time-after-start </span><span class="si">{</span><span class="n">equilibration_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --time-interval </span><span class="si">{</span><span class="n">time_difference</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --num-frames </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="n">analysis_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --central-atom </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unique_elements</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">FOR VAF/VDOS ANALYSIS:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --start </span><span class="si">{</span><span class="n">equilibration_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --nframes </span><span class="si">{</span><span class="n">analysis_frames</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --stride 1&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; --time-interval </span><span class="si">{</span><span class="n">time_difference</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="export_verification_trajectory">
<a class="viewcode-back" href="../../target.html#target.input_reader.export_verification_trajectory">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">export_verification_trajectory</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">inp_array</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;cpdyana_verification.xyz&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export a short verification trajectory for quality assurance.</span>

<span class="sd">    Args:</span>
<span class="sd">        positions (np.ndarray): Array of positions (frames, atoms, 3).</span>
<span class="sd">        cells (np.ndarray): Array of cell matrices (frames, 3, 3).</span>
<span class="sd">        inp_array (list): List of element symbols.</span>
<span class="sd">        times (np.ndarray): Array of time values.</span>
<span class="sd">        output_path (str): Output file path.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None. Writes a trajectory file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== EXPORTING VERIFICATION TRAJECTORY ===&quot;</span><span class="p">)</span>
    <span class="n">atoms_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">export_frames</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># First 100 frames</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">export_frames</span><span class="p">):</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="n">inp_array</span><span class="p">,</span>
                     <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                     <span class="n">cell</span><span class="o">=</span><span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                     <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">atoms_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    
    <span class="n">write</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">atoms_list</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;extxyz&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verification trajectory (first </span><span class="si">{</span><span class="n">export_frames</span><span class="si">}</span><span class="s2"> frames) saved as &#39;</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="has_type_column">
<a class="viewcode-back" href="../../target.html#target.input_reader.has_type_column">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">has_type_column</span><span class="p">(</span><span class="n">lammps_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a LAMMPS dump file has a &#39;type&#39; column in its ATOMS section.</span>

<span class="sd">    Args:</span>
<span class="sd">        lammps_file (str): Path to LAMMPS dump file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if &#39;type&#39; column is present, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lammps_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ITEM: ATOMS&#39;</span><span class="p">):</span>
                <span class="c1"># Example: ITEM: ATOMS id type xu yu zu</span>
                <span class="n">header</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">return</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">header</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<span class="c1"># def iter_lammps_trajectory(lammps_file, elements=None, timestep=None,</span>
<span class="c1">#                            Conv_factor=1.0, element_mapping=None,</span>
<span class="c1">#                            yield_summary=False):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Generator version of read_lammps_trajectory: yields one frame at a time as a dict,</span>
<span class="c1">#     including per-frame thermodynamic data (volume, etc.).</span>
<span class="c1">#     If yield_summary=True, yields a summary dict at the end with all arrays.</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     types_list = None</span>
<span class="c1">#     if element_mapping:</span>
<span class="c1">#         max_type = max(element_mapping)</span>
<span class="c1">#         types_list = [element_mapping[i] for i in range(1, max_type+1)]</span>
<span class="c1">#     elif elements:</span>
<span class="c1">#         types_list = elements</span>

<span class="c1">#     # Prepare accumulators for summary</span>
<span class="c1">#     positions_list = []</span>
<span class="c1">#     cells_list = []</span>
<span class="c1">#     volumes_list = []</span>
<span class="c1">#     timesteps_list = []</span>
<span class="c1">#     symbols = None</span>

<span class="c1">#     print(f&quot;\n=== LAZY LAMMPS TRAJECTORY PROCESSING WITH SAMOS ===&quot;)</span>
<span class="c1">#     print(f&quot;Reading LAMMPS file: {lammps_file}&quot;)</span>
<span class="c1">#     print(f&quot;Element types provided: {elements}&quot;)</span>
<span class="c1">#     print(f&quot;Timestep: {timestep} ps&quot;)</span>
<span class="c1">#     print(f&quot;Element mapping provided: {element_mapping}&quot;)</span>

<span class="c1">#     for frame in iter_lammps_dump(</span>
<span class="c1">#         filename=lammps_file,</span>
<span class="c1">#         elements=elements,</span>
<span class="c1">#         types=types_list,</span>
<span class="c1">#         timestep=timestep * 1000 if timestep else None,</span>
<span class="c1">#         f_conv=Conv_factor,</span>
<span class="c1">#         quiet=False</span>
<span class="c1">#     ):</span>
<span class="c1">#         positions = frame[&quot;positions&quot;]</span>
<span class="c1">#         cell = frame[&quot;cell&quot;]</span>
<span class="c1">#         symbols = frame[&quot;symbols&quot;]</span>
<span class="c1">#         vol = np.linalg.det(cell)</span>
<span class="c1">#         tstep = frame.get(&quot;timestep&quot;, None)</span>

<span class="c1">#         # Accumulate for summary</span>
<span class="c1">#         positions_list.append(positions)</span>
<span class="c1">#         cells_list.append(cell)</span>
<span class="c1">#         volumes_list.append(vol)</span>
<span class="c1">#         timesteps_list.append(tstep)</span>

<span class="c1">#         # Per-frame thermodynamic data (can be expanded as needed)</span>
<span class="c1">#         frame[&quot;volume&quot;] = vol</span>
<span class="c1">#         frame[&quot;cell_temp&quot;] = 300.0  # Default</span>
<span class="c1">#         frame[&quot;ion_temp&quot;] = 300.0   # Default</span>
<span class="c1">#         frame[&quot;pressure&quot;] = 0.0     # Default</span>
<span class="c1">#         frame[&quot;tot_energy&quot;] = 0.0   # Default</span>
<span class="c1">#         frame[&quot;enthalpy&quot;] = 0.0     # Default</span>

<span class="c1">#         yield frame</span>

<span class="c1">#     if yield_summary:</span>
<span class="c1">#         # After all frames, yield a summary dict</span>
<span class="c1">#         positions_arr = np.array(positions_list)  # (n_frames, n_atoms, 3)</span>
<span class="c1">#         cells_arr = np.array(cells_list)          # (n_frames, 3, 3)</span>
<span class="c1">#         n_frames = len(positions_list)</span>
<span class="c1">#         n_atoms = positions_arr.shape[1] if n_frames &gt; 0 else 0</span>
<span class="c1">#         pos_full = np.transpose(positions_arr, (1, 0, 2))  # (atoms, frames, xyz)</span>
<span class="c1">#         cell_param_full = cells_arr.reshape(n_frames, 9)</span>
<span class="c1">#         dt_full = np.array([timestep] * (n_frames - 1)) if timestep else np.ones(n_frames - 1)</span>
<span class="c1">#         t_full = np.concatenate(([0], np.cumsum(dt_full)))</span>
<span class="c1">#         vol_full = np.array(volumes_list)</span>
<span class="c1">#         inp_array = symbols if symbols is not None else [&#39;H&#39;] * n_atoms</span>

<span class="c1">#         print(&quot;\n=== CREATING ENHANCED TRAJECTORY ARRAYS ===&quot;)</span>
<span class="c1">#         print(f&quot;pos_full shape: {pos_full.shape} (atoms, frames, xyz)&quot;)</span>
<span class="c1">#         print(f&quot;cell_param_full shape: {cell_param_full.shape} (frames, 9_params)&quot;)</span>
<span class="c1">#         print(f&quot;Volume range: {vol_full.min():.2f} to {vol_full.max():.2f} Ã…Â³&quot;)</span>
<span class="c1">#         summary = {</span>
<span class="c1">#             &quot;pos_full&quot;: pos_full,</span>
<span class="c1">#             &quot;n_frames&quot;: n_frames,</span>
<span class="c1">#             &quot;dt_full&quot;: dt_full,</span>
<span class="c1">#             &quot;t_full&quot;: t_full,</span>
<span class="c1">#             &quot;cell_param_full&quot;: cell_param_full,</span>
<span class="c1">#             &quot;volumes&quot;: vol_full,</span>
<span class="c1">#             &quot;inp_array&quot;: inp_array,</span>
<span class="c1">#         }</span>
<span class="c1">#         yield summary</span>

<div class="viewcode-block" id="read_lammps_trajectory">
<a class="viewcode-back" href="../../target.html#target.input_reader.read_lammps_trajectory">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_lammps_trajectory</span><span class="p">(</span><span class="n">lammps_file</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">thermo_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Conv_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">element_mapping</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">export_verification</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_recommendations</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read and parse a LAMMPS trajectory file and convert to CPDyAna format.</span>

<span class="sd">    Args:</span>
<span class="sd">        lammps_file (str): Path to LAMMPS dump file.</span>
<span class="sd">        elements (list): List of element symbols for atom types.</span>
<span class="sd">        timestep (float): Timestep in ps.</span>
<span class="sd">        thermo_file (str): Optional, path to LAMMPS thermo file.</span>
<span class="sd">        Conv_factor (float): Conversion factor for units.</span>
<span class="sd">        element_mapping (dict): Mapping from type index to element symbol.</span>
<span class="sd">        export_verification (bool): Export verification trajectory.</span>
<span class="sd">        show_recommendations (bool): Print analysis recommendations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (pos_full, n_frames, dt_full, t_full, cell_param_full, thermo_data, volumes, inp_array)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== ENHANCED LAMMPS TRAJECTORY PROCESSING WITH SAMOS ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading LAMMPS file: </span><span class="si">{</span><span class="n">lammps_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element types provided: </span><span class="si">{</span><span class="n">elements</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timestep: </span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2"> ps&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element mapping provided: </span><span class="si">{</span><span class="n">element_mapping</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check if the LAMMPS dump file has a &#39;type&#39; column</span>
    <span class="n">has_type</span> <span class="o">=</span> <span class="n">has_type_column</span><span class="p">(</span><span class="n">lammps_file</span><span class="p">)</span>
    
    <span class="c1"># Prepare keyword arguments for read_lammps_dump</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">lammps_file</span><span class="p">,</span>
        <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span> <span class="o">*</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">timestep</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Convert ps to fs</span>
        <span class="n">thermo_file</span><span class="o">=</span><span class="n">thermo_file</span><span class="p">,</span>
        <span class="n">f_conv</span><span class="o">=</span><span class="n">Conv_factor</span><span class="p">,</span>
        <span class="n">e_conv</span><span class="o">=</span><span class="n">Conv_factor</span><span class="p">,</span>
        <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    
    <span class="c1"># Assign types based on element_mapping or elements</span>
    <span class="k">if</span> <span class="n">has_type</span> <span class="ow">and</span> <span class="n">element_mapping</span><span class="p">:</span>
        <span class="c1"># Convert mapping dict {1:&#39;Li&#39;, 2:&#39;La&#39;, ...} to list [&#39;Li&#39;, &#39;La&#39;, ...]</span>
        <span class="c1"># Ensure order is by type number (1-based)</span>
        <span class="n">max_type</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">element_mapping</span><span class="p">)</span>
        <span class="n">types_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">element_mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_type</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">types_list</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using element mapping for types in trajectory reading (converted to list)&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">has_type</span> <span class="ow">and</span> <span class="n">elements</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elements</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using elements list for types in trajectory reading&quot;</span><span class="p">)</span>

    <span class="c1"># Read the trajectory using SAMOS</span>
    <span class="n">trajectory</span> <span class="o">=</span> <span class="n">read_lammps_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="c1"># Extract trajectory data</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>  <span class="c1"># Shape: (n_frames, n_atoms, 3)</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">get_cells</span><span class="p">()</span>          <span class="c1"># Shape: (n_frames, 3, 3)</span>
    <span class="n">n_frames</span><span class="p">,</span> <span class="n">n_atoms</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">shape</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trajectory shape: </span><span class="si">{</span><span class="n">positions</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> (frames, atoms, xyz)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of frames: </span><span class="si">{</span><span class="n">n_frames</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of atoms: </span><span class="si">{</span><span class="n">n_atoms</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">atom_types</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">get_types</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieved atom types from trajectory: </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">atom_types</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Could not retrieve atom types from trajectory&quot;</span><span class="p">)</span>
        <span class="n">atom_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_atoms</span>
    
    <span class="c1"># Use atom_types directly as inp_array (no re-mapping needed)</span>
    <span class="n">inp_array</span> <span class="o">=</span> <span class="n">atom_types</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element assignment complete. Sample: </span><span class="si">{</span><span class="n">inp_array</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element distribution: </span><span class="si">{</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">inp_array</span><span class="p">,</span><span class="w"> </span><span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Fallback logic for element assignment if necessary</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_type</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elements</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_atoms</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using provided elements array (length matches atom count)&quot;</span><span class="p">)</span>
            <span class="n">inp_array</span> <span class="o">=</span> <span class="n">elements</span>
        <span class="k">elif</span> <span class="n">elements</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Element count mismatch: Expected </span><span class="si">{</span><span class="n">n_atoms</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Extending element list to match atom count...&quot;</span><span class="p">)</span>
            <span class="n">inp_array</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">element_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">):</span>
                <span class="n">element_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">element_count</span>
                <span class="n">inp_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">element_idx</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extended element assignment complete&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: No elements or mapping provided. Defaulting to &#39;H&#39; for all atoms.&quot;</span><span class="p">)</span>
            <span class="n">inp_array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_atoms</span>

    <span class="c1"># Convert to CPDyAna format</span>
    <span class="n">pos_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># Shape: (atoms, frames, xyz)</span>
    <span class="n">cell_param_full</span> <span class="o">=</span> <span class="n">cells</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_frames</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>   <span class="c1"># Flatten 3x3 to 9-element vectors</span>
    
    <span class="c1"># Generate time array</span>
    <span class="n">dt_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timestep</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_frames</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">timestep</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_frames</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">t_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dt_full</span><span class="p">)))</span>  <span class="c1"># Cumulative time starting at 0</span>
    
    <span class="c1"># Thermodynamic data generation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== CREATING ENHANCED TRAJECTORY ARRAYS ===&quot;</span><span class="p">)</span>
    <span class="n">steps_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
    <span class="n">ke_elec_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
    <span class="n">cell_temp_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span> <span class="o">*</span> <span class="mf">300.0</span>  <span class="c1"># Default 300K</span>
    <span class="n">ion_temp_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span> <span class="o">*</span> <span class="mf">300.0</span>
    <span class="n">tot_energy_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
    <span class="n">enthalpy_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
    <span class="n">tot_energy_ke_ion_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
    <span class="n">tot_energy_ke_ion_ke_elec_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
    <span class="n">vol_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">])</span>
    <span class="n">pressure_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pos_full shape: </span><span class="si">{</span><span class="n">pos_full</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> (atoms, frames, xyz)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cell_param_full shape: </span><span class="si">{</span><span class="n">cell_param_full</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> (frames, 9_params)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volume range: </span><span class="si">{</span><span class="n">vol_full</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">vol_full</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Ã…Â³&quot;</span><span class="p">)</span>
    
    <span class="c1"># Analysis parameter recommendations</span>
    <span class="k">if</span> <span class="n">show_recommendations</span><span class="p">:</span>
        <span class="n">generate_analysis_recommendations</span><span class="p">(</span><span class="n">t_full</span><span class="p">,</span> <span class="n">dt_full</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt_full</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">n_frames</span><span class="p">,</span> <span class="n">inp_array</span><span class="p">)</span>
    
    <span class="c1"># Optional trajectory verification export</span>
    <span class="k">if</span> <span class="n">export_verification</span><span class="p">:</span>
        <span class="n">export_verification_trajectory</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">inp_array</span><span class="p">,</span> <span class="n">t_full</span><span class="p">)</span>
    
    <span class="c1"># Extract thermodynamic data</span>
    <span class="n">thermo_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="s1">&#39;get_pot_energies&#39;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">thermo_data</span><span class="p">[</span><span class="s1">&#39;potential_energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">get_pot_energies</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    
    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== ENHANCED PROCESSING COMPLETE ===&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">pos_full</span><span class="p">,</span> <span class="n">n_frames</span><span class="p">,</span> <span class="n">dt_full</span><span class="p">,</span> <span class="n">t_full</span><span class="p">,</span> <span class="n">cell_param_full</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">,</span> <span class="n">volumes</span><span class="p">,</span> <span class="n">inp_array</span><span class="p">)</span></div>


<span class="c1"># def iter_bomd_trajectory(bomd_file, elements=None):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Generator version of read_bomd_trajectory: yields one frame at a time as a dict,</span>
<span class="c1">#     including per-frame thermodynamic data (volume, etc.).</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     bohr_to_ang = 0.529177</span>
<span class="c1">#     with open(bomd_file, &#39;r&#39;) as f:</span>
<span class="c1">#         lines = f.readlines()</span>
<span class="c1">#     idx = 0</span>
<span class="c1">#     n_lines = len(lines)</span>
<span class="c1">#     # Auto-detect n_atoms</span>
<span class="c1">#     while idx &lt; n_lines:</span>
<span class="c1">#         if lines[idx].strip().startswith(&quot;TIME&quot;):</span>
<span class="c1">#             idx0 = idx</span>
<span class="c1">#             break</span>
<span class="c1">#         idx += 1</span>
<span class="c1">#     idx += 1  # Move to cell</span>
<span class="c1">#     cell_lines = lines[idx:idx+3]</span>
<span class="c1">#     idx += 3</span>
<span class="c1">#     # Count atom lines</span>
<span class="c1">#     atom_start = idx</span>
<span class="c1">#     while idx &lt; n_lines and not lines[idx].strip().startswith(&quot;TIME&quot;):</span>
<span class="c1">#         idx += 1</span>
<span class="c1">#     n_atoms = idx - atom_start</span>
<span class="c1">#     idx = 0</span>
<span class="c1">#     while idx &lt; n_lines:</span>
<span class="c1">#         if not lines[idx].strip().startswith(&quot;TIME&quot;):</span>
<span class="c1">#             idx += 1</span>
<span class="c1">#             continue</span>
<span class="c1">#         header = lines[idx].strip().split()</span>
<span class="c1">#         time_ps = float(header[0].replace(&quot;TIME(ps)&quot;, &quot;&quot;)) if &quot;TIME&quot; in header[0] else float(header[1])</span>
<span class="c1">#         step_idx = int(header[1]) if &quot;TIME&quot; in header[0] else int(header[2])</span>
<span class="c1">#         energy_ry = float(header[2]) if &quot;TIME&quot; in header[0] else float(header[3])</span>
<span class="c1">#         idx += 1</span>
<span class="c1">#         cell = []</span>
<span class="c1">#         for _ in range(3):</span>
<span class="c1">#             cell.append([float(x) * bohr_to_ang for x in lines[idx].split()])</span>
<span class="c1">#             idx += 1</span>
<span class="c1">#         frame_pos = []</span>
<span class="c1">#         for _ in range(n_atoms):</span>
<span class="c1">#             frame_pos.append([float(x) * bohr_to_ang for x in lines[idx].split()])</span>
<span class="c1">#             idx += 1</span>
<span class="c1">#         # Assign elements</span>
<span class="c1">#         if elements and len(elements) == n_atoms:</span>
<span class="c1">#             inp_array = elements</span>
<span class="c1">#         else:</span>
<span class="c1">#             inp_array = [&#39;H&#39;] * n_atoms</span>

<span class="c1">#         cell_np = np.array(cell)</span>
<span class="c1">#         vol = np.linalg.det(cell_np)</span>
<span class="c1">#         # Add per-frame thermodynamic data (default values for temperature, pressure, etc.)</span>
<span class="c1">#         yield {</span>
<span class="c1">#             &quot;positions&quot;: np.array(frame_pos),</span>
<span class="c1">#             &quot;cell&quot;: cell_np,</span>
<span class="c1">#             &quot;timestep&quot;: time_ps,</span>
<span class="c1">#             &quot;energy_ry&quot;: energy_ry,</span>
<span class="c1">#             &quot;symbols&quot;: inp_array,</span>
<span class="c1">#             &quot;volume&quot;: vol,</span>
<span class="c1">#             &quot;cell_temp&quot;: 300.0,   # Default temperature</span>
<span class="c1">#             &quot;ion_temp&quot;: 300.0,    # Default temperature</span>
<span class="c1">#             &quot;pressure&quot;: 0.0,      # Default pressure</span>
<span class="c1">#             &quot;tot_energy&quot;: 0.0,    # Default total energy</span>
<span class="c1">#             &quot;enthalpy&quot;: 0.0       # Default enthalpy</span>
<span class="c1">#         }</span>

<div class="viewcode-block" id="read_bomd_trajectory">
<a class="viewcode-back" href="../../target.html#target.input_reader.read_bomd_trajectory">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_bomd_trajectory</span><span class="p">(</span><span class="n">bomd_file</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">export_verification</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read BOMD trajectory file (.trj or .trajectory) and convert to CPDyAna format.</span>

<span class="sd">    Args:</span>
<span class="sd">        bomd_file (str): Path to BOMD trajectory file.</span>
<span class="sd">        elements (list): List of element symbols (length = n_atoms).</span>
<span class="sd">        timestep (float): Optional, time step in ps.</span>
<span class="sd">        export_verification (bool): Export verification trajectory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (positions, n_frames, dt_full, t_full, cell_param_full, thermo_data, volumes, inp_array)</span>
<span class="sd">            positions (np.ndarray): (atoms, frames, 3)</span>
<span class="sd">            n_frames (int): Number of frames</span>
<span class="sd">            dt_full (np.ndarray): (frames-1,) time differences</span>
<span class="sd">            t_full (np.ndarray): (frames,) time values</span>
<span class="sd">            cell_param_full (np.ndarray): (frames, 9)</span>
<span class="sd">            thermo_data (dict): Thermodynamic data</span>
<span class="sd">            volumes (list): Cell volumes</span>
<span class="sd">            inp_array (list): element symbols per atom</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bohr_to_ang</span> <span class="o">=</span> <span class="mf">0.529177</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">energies</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bomd_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="c1"># Auto-detect n_atoms</span>
    <span class="c1"># Find first header, then next 3 lines (cell), then count until next header</span>
    <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">n_lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TIME&quot;</span><span class="p">):</span>
            <span class="n">idx0</span> <span class="o">=</span> <span class="n">idx</span>
            <span class="k">break</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Move to cell</span>
    <span class="n">cell_lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">3</span>
    <span class="c1"># Count atom lines</span>
    <span class="n">atom_start</span> <span class="o">=</span> <span class="n">idx</span>
    <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">n_lines</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TIME&quot;</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">-</span> <span class="n">atom_start</span>
    <span class="c1"># Now parse all frames</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">n_lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TIME&quot;</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">time_ps</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;TIME(ps)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="s2">&quot;TIME&quot;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">step_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="s2">&quot;TIME&quot;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">energy_ry</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="s2">&quot;TIME&quot;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_ps</span><span class="p">)</span>
        <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy_ry</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">bohr_to_ang</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cell</span><span class="p">))</span>
        <span class="n">frame_pos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">):</span>
            <span class="n">frame_pos</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">bohr_to_ang</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame_pos</span><span class="p">)</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>  <span class="c1"># (frames, atoms, 3)</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># (atoms, frames, 3)</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>  <span class="c1"># (frames, 3, 3)</span>
    <span class="n">cell_param_full</span> <span class="o">=</span> <span class="n">cells</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">n_frames</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dt_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_frames</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">t_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">]</span>
    <span class="n">thermo_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;total_energy_ry&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energies</span><span class="p">)}</span>
    <span class="c1"># Element assignment</span>
    <span class="k">if</span> <span class="n">elements</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_atoms</span><span class="p">:</span>
        <span class="n">inp_array</span> <span class="o">=</span> <span class="n">elements</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inp_array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_atoms</span>
    <span class="c1"># Optional verification export</span>
    <span class="k">if</span> <span class="n">export_verification</span><span class="p">:</span>
        <span class="n">export_verification_trajectory</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">inp_array</span><span class="p">,</span> <span class="n">t_full</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">n_frames</span><span class="p">,</span> <span class="n">dt_full</span><span class="p">,</span> <span class="n">t_full</span><span class="p">,</span> <span class="n">cell_param_full</span><span class="p">,</span> <span class="n">thermo_data</span><span class="p">,</span> <span class="n">volumes</span><span class="p">,</span> <span class="n">inp_array</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_ion_file_universal">
<a class="viewcode-back" href="../../target.html#target.input_reader.read_ion_file_universal">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_ion_file_universal</span><span class="p">(</span><span class="n">ion_file_or_elements</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Universal ion reader that handles both .in files and element lists.</span>

<span class="sd">    Args:</span>
<span class="sd">        ion_file_or_elements: Either path to .in file or list of elements</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Ion symbols</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ion_file_or_elements</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Original QE .in file reader</span>
        <span class="k">return</span> <span class="n">read_ion_file</span><span class="p">(</span><span class="n">ion_file_or_elements</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ion_file_or_elements</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1"># Direct element list from LAMMPS</span>
        <span class="k">return</span> <span class="n">ion_file_or_elements</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid ion file or elements specification&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_ion_file">
<a class="viewcode-back" href="../../target.html#target.input_reader.read_ion_file">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_ion_file</span><span class="p">(</span><span class="n">ion_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read and parse ion definition file containing atomic species information.</span>

<span class="sd">    The ion file typically contains atomic symbols, masses, and other properties</span>
<span class="sd">    for each species in the simulation. This function extracts this information</span>
<span class="sd">    and returns it in a structured format.</span>

<span class="sd">    Args:</span>
<span class="sd">        ion_file (str): Path to the ion definition file (.in format).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List of atomic symbols (e.g., [&#39;Li&#39;, &#39;Al&#39;, &#39;P&#39;, &#39;S&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_ions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Read all lines from the ion file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ion_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="c1"># Find the line containing &#39;ATOMIC_POSITIONS&#39; keyword</span>
    <span class="n">line_number</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s1">&#39;ATOMIC_POSITIONS&#39;</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="n">line_number</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">break</span>
    <span class="c1"># Extract ion types from lines following ATOMIC_POSITIONS</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">line_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]:</span>
        <span class="c1"># Skip empty lines at the beginning</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_ions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># Stop when we reach an empty line after collecting ions</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># First element is the atomic species</span>
        <span class="n">total_ions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_ions</span></div>


<div class="viewcode-block" id="read_cel_file">
<a class="viewcode-back" href="../../target.html#target.input_reader.read_cel_file">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_cel_file</span><span class="p">(</span><span class="n">cel_file</span><span class="p">,</span> <span class="n">Length_conversion_factor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read unit cell parameter file containing lattice vectors and cell dimensions.</span>

<span class="sd">    The cell file contains time-dependent lattice vectors that define the</span>
<span class="sd">    simulation box boundaries. This is crucial for applying periodic boundary</span>
<span class="sd">    conditions and calculating volumes.</span>

<span class="sd">    Args:</span>
<span class="sd">        cel_file (str): Path to the cell parameter file (.cel format).</span>
<span class="sd">        Length_conversion_factor (float): Unit conversion factor (e.g., 0.529177249 for Bohr to Angstrom).</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Array with shape (n_frames, 9) containing lattice vectors:</span>
<span class="sd">            [a1_x, a1_y, a1_z, a2_x, a2_y, a2_z, a3_x, a3_y, a3_z]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cell_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cel_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="c1"># Process every 4 lines (skip header, read 3 cell vectors)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="mi">4</span><span class="p">):</span>
            <span class="c1"># Read and convert the three cell vectors (lines i+1, i+2, i+3)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">*</span><span class="n">Length_conversion_factor</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="n">values</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">*</span><span class="n">Length_conversion_factor</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="n">values</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">*</span><span class="n">Length_conversion_factor</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="n">cell_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cell_data</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_evp_file">
<a class="viewcode-back" href="../../target.html#target.input_reader.read_evp_file">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_evp_file</span><span class="p">(</span><span class="n">evp_file</span><span class="p">,</span> <span class="n">Length_conversion_factor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read energy, volume, and pressure file containing thermodynamic properties.</span>

<span class="sd">    The EVP file contains time-series data of various thermodynamic quantities</span>
<span class="sd">    including kinetic energies, total energy, enthalpy, volume, pressure, and</span>
<span class="sd">    temperatures for different components of the system.</span>

<span class="sd">    Args:</span>
<span class="sd">        evp_file (str): Path to the EVP file (.evp format).</span>
<span class="sd">        Length_conversion_factor (float): Unit conversion factor for energy and volume.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Contains the following arrays:</span>
<span class="sd">            - ke_elec (np.ndarray): Electronic kinetic energy</span>
<span class="sd">            - cell_temp (np.ndarray): Cell temperature</span>
<span class="sd">            - ion_temp (np.ndarray): Ionic temperature  </span>
<span class="sd">            - tot_energy (np.ndarray): Total energy</span>
<span class="sd">            - enthalpy (np.ndarray): Enthalpy</span>
<span class="sd">            - tot_energy_ke_ion (np.ndarray): Total energy + ionic KE</span>
<span class="sd">            - tot_energy_ke_ion_ke_elec (np.ndarray): Total energy + all KE</span>
<span class="sd">            - volume (np.ndarray): Cell volume</span>
<span class="sd">            - pressure (np.ndarray): Pressure</span>
<span class="sd">            - n_frames (int): Number of time frames</span>
<span class="sd">            - time_diff (float): Time step between frames</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize lists for all thermodynamic properties</span>
    <span class="n">ke_electronic</span><span class="p">,</span> <span class="n">cell_temp</span><span class="p">,</span> <span class="n">ion_temp</span><span class="p">,</span> <span class="n">tot_energy</span><span class="p">,</span> <span class="n">enthalpy</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">tot_energy_ke_ion</span><span class="p">,</span> <span class="n">tot_energy_ke_ion_ke_elec</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">pressure</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="c1"># Variables to calculate time step information</span>
    <span class="n">first_term</span><span class="p">,</span> <span class="n">first_time</span><span class="p">,</span> <span class="n">second_term</span><span class="p">,</span> <span class="n">second_time</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="c1"># Read file and filter out comment lines</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">evp_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)]</span>
    <span class="c1"># Parse each line of data</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="c1"># Store first and second frame information for time calculation</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">first_term</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">first_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">second_term</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">second_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Extract all thermodynamic properties</span>
        <span class="n">ke_electronic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">cell_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">ion_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">tot_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
        <span class="n">enthalpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
        <span class="n">tot_energy_ke_ion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
        <span class="n">tot_energy_ke_ion_ke_elec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
        <span class="n">vol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="o">*</span> <span class="n">Length_conversion_factor</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Convert volume units</span>
        <span class="n">pressure</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
    <span class="c1"># Calculate time step information</span>
    <span class="n">number_of_time_frames</span> <span class="o">=</span> <span class="n">second_term</span> <span class="o">-</span> <span class="n">first_term</span> <span class="k">if</span> <span class="n">first_term</span> <span class="ow">and</span> <span class="n">second_term</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">time_difference</span> <span class="o">=</span> <span class="n">second_time</span> <span class="o">-</span> <span class="n">first_time</span> <span class="k">if</span> <span class="n">first_time</span> <span class="ow">and</span> <span class="n">second_time</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ke_electronic</span><span class="p">,</span> <span class="n">cell_temp</span><span class="p">,</span> <span class="n">ion_temp</span><span class="p">,</span> <span class="n">tot_energy</span><span class="p">,</span> <span class="n">enthalpy</span><span class="p">,</span> 
            <span class="n">tot_energy_ke_ion</span><span class="p">,</span> <span class="n">tot_energy_ke_ion_ke_elec</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> 
            <span class="n">number_of_time_frames</span><span class="p">,</span> <span class="n">time_difference</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_pos_file">
<a class="viewcode-back" href="../../target.html#target.input_reader.read_pos_file">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_pos_file</span><span class="p">(</span><span class="n">pos_file</span><span class="p">,</span> <span class="n">total_ions</span><span class="p">,</span> <span class="n">Length_conversion_factor</span><span class="p">,</span> <span class="n">number_of_time_frames</span><span class="p">,</span> <span class="n">time_difference</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read position trajectory file containing atomic coordinates over time.</span>

<span class="sd">    The position file contains the time evolution of atomic coordinates for all</span>
<span class="sd">    atoms in the simulation. This function parses the file and organizes the</span>
<span class="sd">    data into arrays suitable for analysis.</span>

<span class="sd">    Args:</span>
<span class="sd">        pos_file (str): Path to the position file (.pos format).</span>
<span class="sd">        total_ions (list): Ion information from read_ion_file().</span>
<span class="sd">        Length_conversion_factor (float): Unit conversion factor (Bohr to Angstrom).</span>
<span class="sd">        number_of_time_frames (int): Number of frames to read.</span>
<span class="sd">        time_difference (float): Time step between frames in ps.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Contains:</span>
<span class="sd">            - positions (np.ndarray): Position array with shape (n_ions, n_frames, 3)</span>
<span class="sd">            - n_steps (int): Number of time steps</span>
<span class="sd">            - dt (np.ndarray): Time differences between steps</span>
<span class="sd">            - time (np.ndarray): Absolute time values in picoseconds</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Read position data using pandas fixed-width format</span>
    <span class="n">pos_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_fwf</span><span class="p">(</span><span class="n">pos_file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Extract time step headers (every (n_ions + 1) lines)</span>
    <span class="n">data_steps</span> <span class="o">=</span> <span class="n">pos_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_data</span><span class="p">):</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_ions</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Create time arrays</span>
    <span class="n">d_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_steps</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Index array starting from 1</span>
    <span class="n">t_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_steps</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Index array starting from 0</span>
    <span class="c1"># Calculate time arrays</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">t_ind</span> <span class="o">*</span> <span class="n">time_difference</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_ind</span><span class="p">))</span> <span class="o">*</span> <span class="n">time_difference</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">d_idx</span> <span class="o">*</span> <span class="n">time_difference</span>
    <span class="c1"># Initialize displacement array: (n_ions, n_timesteps, 3_coordinates)</span>
    <span class="n">ion_disp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">total_ions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_steps</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
    <span class="c1"># Extract position data for each ion</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">total_ions</span><span class="p">)):</span>
        <span class="c1"># Get positions for ion i at all time steps (skip headers)</span>
        <span class="n">ion_data</span> <span class="o">=</span> <span class="n">pos_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_data</span><span class="p">):</span><span class="nb">len</span><span class="p">(</span><span class="n">total_ions</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Convert to numpy array and apply length conversion</span>
        <span class="n">ion_pos</span> <span class="o">=</span> <span class="n">ion_data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">Length_conversion_factor</span>
        <span class="n">ion_disp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ion_pos</span>
    <span class="k">return</span> <span class="n">ion_disp</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_steps</span><span class="p">),</span> <span class="n">dt</span><span class="p">,</span> <span class="n">time</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Vinay Maithani.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>